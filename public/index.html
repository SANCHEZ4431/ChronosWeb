<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chronos Control Database</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <style>
    /* * PROJECT: NEURAL INTERFACE v4.0 (FUTURISTIC DESIGN)
     * LINES: 500+ CSS Definition
     */

    :root {
        --bg: #05050a; 
        --surface: #0f0f1e; 
        --surface-light: #1a1a2e;
        --accent: #00e5ff; 
        --accent-glow: rgba(0, 229, 255, 0.3);
        --text: #f0f0f0;
        --text-dim: #94a3b8;
        --legendary: #ffaa00; 
        --epic: #d000ff; 
        --rare: #0077ff; 
        --common: #ffffff;
        --danger: #ff3366;
        --success: #00ffa3;
        --vip: #fcd34d;
        --admin: #ef4444;
        
        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –¥–∏–∑–∞–π–Ω–∞ */
        --border-color: rgba(0, 229, 255, 0.15);
        --neon-shadow: 0 0 15px var(--accent-glow);
        --font-main: 'Inter', 'Segoe UI', Roboto, sans-serif;
        --font-mono: 'Fira Code', monospace;
        --transition-fast: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        --transition-slow: 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* --- –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ --- */
    * {
        box-sizing: border-box;
        outline: none;
    }

    body { 
        font-family: var(--font-main); 
        background: var(--bg); 
        color: var(--text); 
        margin: 0; 
        padding: 0;
        overflow-x: hidden;
        line-height: 1.5;
        background-image: 
            radial-gradient(circle at 2px 2px, rgba(255,255,255,0.02) 1px, transparent 0);
        background-size: 40px 40px;
        position: relative;
    }

    /* –≠—Ñ—Ñ–µ–∫—Ç —Å–∫–∞–Ω–∏—Ä—É—é—â–µ–π –ª–∏–Ω–∏–∏ */
    body::before {
        content: "";
        position: fixed;
        top: 0; left: 0;
        width: 100vw; height: 100vh;
        background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.2) 50%), 
                    linear-gradient(90deg, rgba(255, 0, 0, 0.03), rgba(0, 255, 0, 0.01), rgba(0, 0, 255, 0.03));
        background-size: 100% 4px, 3px 100%;
        pointer-events: none;
        z-index: 9999;
        opacity: 0.3;
    }

    /* --- Global Scrollbar --- */
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: var(--bg); }
    ::-webkit-scrollbar-thumb { 
        background: var(--surface-light); 
        border-radius: 10px;
        border: 1px solid var(--border-color);
    }
    ::-webkit-scrollbar-thumb:hover { 
        background: var(--accent); 
        box-shadow: var(--neon-shadow);
    }

    /* --- Layout --- */
    .container { 
        max-width: 1500px; 
        margin: 0 auto; 
        padding: 40px 25px; 
        position: relative;
        animation: fadeIn var(--transition-slow);
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    /* --- Header & Logo --- */
    header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 40px;
        background: linear-gradient(90deg, var(--surface) 0%, rgba(15, 15, 30, 0.4) 100%);
        padding: 25px 35px;
        border-radius: 16px;
        border-left: 4px solid var(--accent);
        border-right: 1px solid var(--border-color);
        border-top: 1px solid var(--border-color);
        border-bottom: 1px solid var(--border-color);
        box-shadow: 20px 0 50px rgba(0,0,0,0.5);
        position: relative;
        overflow: hidden;
    }

    header::after {
        content: "SYSTEM_ACTIVE";
        position: absolute;
        bottom: 5px; right: 20px;
        font-family: var(--font-mono);
        font-size: 8px;
        color: var(--accent);
        opacity: 0.5;
        letter-spacing: 2px;
    }

    .logo h1 {
        margin: 0;
        font-weight: 800;
        letter-spacing: -1px;
        font-size: 32px;
        background: linear-gradient(135deg, #fff 30%, var(--accent));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        filter: drop-shadow(0 0 10px var(--accent-glow));
        text-transform: uppercase;
    }

    /* --- Stats Overview --- */
    .stats-overview {
        display: flex;
        gap: 20px;
    }

    .stat-pill {
        background: var(--surface-light);
        padding: 10px 20px;
        border-radius: 12px;
        font-size: 13px;
        border: 1px solid rgba(255,255,255,0.05);
        display: flex;
        align-items: center;
        gap: 10px;
        transition: var(--transition-fast);
        position: relative;
        overflow: hidden;
    }

    .stat-pill::before {
        content: "";
        position: absolute;
        top: 0; left: -100%;
        width: 100%; height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.05), transparent);
        transition: 0.5s;
    }

    .stat-pill:hover::before { left: 100%; }

    .stat-pill:hover {
        border-color: var(--accent);
        background: rgba(0, 229, 255, 0.05);
        transform: translateY(-2px);
    }

    .stat-pill span { 
        color: var(--accent); 
        font-weight: 800; 
        font-family: var(--font-mono);
        text-shadow: 0 0 8px var(--accent-glow);
    }

    /* --- Search & Controls --- */
    .search-bar {
        margin-bottom: 30px;
        display: flex;
        gap: 15px;
    }

    .search-bar input {
        background: var(--surface);
        border: 1px solid var(--border-color);
        padding: 15px 25px;
        border-radius: 14px;
        color: white;
        flex-grow: 1;
        font-size: 15px;
        transition: var(--transition-fast);
    }

    .search-bar input:focus {
        border-color: var(--accent);
        box-shadow: inset 0 0 10px rgba(0, 229, 255, 0.1), var(--neon-shadow);
    }

    /* --- Table Card --- */
    .table-card {
        background: var(--surface);
        border-radius: 24px;
        box-shadow: 0 35px 70px -15px rgba(0,0,0,0.8);
        border: 1px solid rgba(255,255,255,0.08);
        overflow: hidden;
        position: relative;
    }

    .table-card::before {
        content: "";
        position: absolute;
        top: 0; left: 0; width: 100%; height: 2px;
        background: linear-gradient(90deg, transparent, var(--accent), transparent);
    }

    table { width: 100%; border-collapse: collapse; }

    th { 
        background: rgba(255,255,255,0.03); 
        color: var(--text-dim); 
        font-size: 12px; 
        text-transform: uppercase; 
        padding: 25px 20px;
        text-align: left;
        letter-spacing: 2px;
        border-bottom: 2px solid rgba(255,255,255,0.05);
        font-weight: 700;
    }

    td { 
        padding: 22px 20px; 
        border-bottom: 1px solid rgba(255,255,255,0.03); 
        font-size: 15px;
        transition: var(--transition-fast);
    }

    tr:last-child td { border-bottom: none; }
    tr.selected td {
    background: linear-gradient(
        90deg,
        rgba(0,255,255,0.18),
        rgba(0,255,255,0.05),
        rgba(0,255,255,0.18)
    );
    box-shadow: 
        inset 0 0 20px rgba(0,255,255,0.35),
        inset 0 0 60px rgba(0,255,255,0.15);
    position: relative;
}

        /* –Ω–µ–æ–Ω–æ–≤–∞—è –ª–∏–Ω–∏—è —Å–ª–µ–≤–∞ */
tr.selected td:first-child {
    border-left: 4px solid var(--accent);
}

/* –∞–Ω–∏–º–∞—Ü–∏—è "—Å–∫–∞–Ω–µ—Ä–∞" –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫–µ */
tr.selected::after {
    content:"";
    position:absolute;
    left:0;
    top:0;
    width:100%;
    height:100%;
    pointer-events:none;
    background: linear-gradient(
        90deg,
        transparent,
        rgba(0,255,255,0.35),
        transparent
    );
    animation: rowScan 1.5s linear infinite;
}

@keyframes rowScan {
    from { background-position: -200% 0; }
    to   { background-position: 200% 0; }
}
    /* --- User Cells --- */
    .user-cell { 
        display: flex; 
        align-items: center; 
        gap: 15px; 
    }

    .avatar-stub {
        width: 42px; height: 42px;
        background: var(--surface-light);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 800;
        color: var(--accent);
        border: 2px solid var(--accent);
        box-shadow: 0 0 10px var(--accent-glow);
        transform: rotate(-3deg);
        transition: var(--transition-fast);
    }

    tr:hover .avatar-stub {
        transform: rotate(0deg) scale(1.1);
    }

    /* --- Badges --- */
    .badge {
        padding: 5px 12px;
        border-radius: 8px;
        font-size: 11px;
        font-weight: 900;
        text-transform: uppercase;
        letter-spacing: 1px;
        display: inline-block;
    }

    .badge-vip { 
        background: var(--vip); 
        color: #000; 
        box-shadow: 0 0 20px rgba(252, 211, 77, 0.4); 
    }

    .badge-admin { 
        background: var(--admin); 
        color: #fff; 
        box-shadow: 0 0 20px rgba(239, 68, 68, 0.4); 
    }

    .badge-rare { background: var(--rare); color: white; }
    .badge-epic { background: var(--epic); color: white; }
    .badge-legendary { background: var(--legendary); color: black; }

    /* --- Modal Overlay --- */
    #overlay { 
        display: none; 
        position: fixed; 
        inset: 0; 
        background: rgba(2, 2, 10, 0.85); 
        backdrop-filter: blur(15px) saturate(180%);
        z-index: 1000; 
        animation: overlayFade 0.3s ease;
    }

    @keyframes overlayFade {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    /* --- Edit Form / Modal --- */
    #editForm {
        display: none; 
        position: fixed; 
        top: 50%; left: 50%; 
        transform: translate(-50%, -50%);
        background: var(--surface); 
        width: 1300px; 
        height: 85vh;
        border-radius: 30px;
        z-index: 1001; 
        overflow: hidden; 
        flex-direction: column; 
        border: 1px solid rgba(0, 229, 255, 0.2);
        box-shadow: 0 0 150px rgba(0,0,0,1), 0 0 40px rgba(0, 229, 255, 0.1);
    }

    /* –î–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ —É–≥–ª—ã –¥–ª—è –º–æ–¥–∞–ª–∫–∏ */
    #editForm::before, #editForm::after {
        content: "";
        position: absolute;
        width: 40px; height: 40px;
        border: 2px solid var(--accent);
        pointer-events: none;
    }
    #editForm::before { top: 20px; left: 20px; border-right: 0; border-bottom: 0; }
    #editForm::after { bottom: 20px; right: 20px; border-left: 0; border-top: 0; }

    /* --- Tabs --- */
    .tabs-header { 
        display: flex; 
        background: rgba(26, 26, 46, 0.8); 
        padding: 20px 40px 0; 
        gap: 10px;
        border-bottom: 1px solid rgba(255,255,255,0.05);
    }

    .tab-btn { 
        padding: 18px 30px; 
        border: none; 
        background: transparent; 
        color: var(--text-dim); 
        cursor: pointer; 
        font-weight: 700; 
        font-size: 14px;
        border-radius: 15px 15px 0 0; 
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        text-transform: uppercase;
        letter-spacing: 1px;
        position: relative;
    }

    .tab-btn:hover { color: #fff; }

    .tab-btn.active { 
        background: var(--surface); 
        color: var(--accent); 
        box-shadow: 0 -10px 25px rgba(0,0,0,0.4);
    }

    .tab-btn.active::after {
        content: "";
        position: absolute;
        bottom: 0; left: 0; width: 100%; height: 3px;
        background: var(--accent);
        box-shadow: 0 0 10px var(--accent);
    }

    /* --- Modal Body --- */
    .modal-scrollbox { 
        padding: 45px; 
        overflow-y: auto; 
        flex-grow: 1; 
        scrollbar-gutter: stable;
    }

    .tab-content { display: none; }
    .tab-content.active { 
        display: block; 
        animation: cyberSlide 0.5s ease-out; 
    }

    @keyframes cyberSlide {
        0% { opacity: 0; transform: translateX(30px); filter: blur(10px); }
        100% { opacity: 1; transform: translateX(0); filter: blur(0); }
    }

    /* --- Editor Grid --- */
    .editor-grid { 
        display: grid; 
        grid-template-columns: repeat(3, 1fr); 
        gap: 35px; 
    }

    .card-box { 
        background: rgba(255,255,255,0.015); 
        padding: 30px; 
        border-radius: 24px; 
        border: 1px solid rgba(255,255,255,0.04);
        transition: var(--transition-fast);
        backdrop-filter: blur(5px);
    }

    .card-box:hover {
        background: rgba(255,255,255,0.03);
        border-color: rgba(0, 229, 255, 0.2);
    }

    .card-box h3 { 
        margin: 0 0 25px 0; 
        color: var(--accent); 
        font-size: 14px; 
        text-transform: uppercase; 
        letter-spacing: 3px;
        display: flex;
        align-items: center;
        gap: 12px;
        font-weight: 900;
    }

    .card-box h3::before {
        content: "";
        width: 8px; height: 8px;
        background: var(--accent);
        box-shadow: 0 0 10px var(--accent);
        display: inline-block;
    }

    /* --- Inputs & Forms --- */
    label { 
        display: block; 
        font-size: 11px; 
        color: var(--text-dim); 
        margin: 20px 0 8px; 
        text-transform: uppercase; 
        font-weight: 800;
        letter-spacing: 1px;
    }

    input, select, textarea { 
        width: 100%; 
        padding: 14px 18px; 
        background: var(--bg); 
        border: 1px solid rgba(255,255,255,0.08); 
        color: #fff; 
        border-radius: 12px; 
        box-sizing: border-box; 
        font-family: var(--font-main);
        transition: all 0.3s;
        font-size: 14px;
    }

    textarea { min-height: 100px; resize: vertical; }

    input:focus, select:focus, textarea:focus { 
        border-color: var(--accent); 
        background: rgba(0, 229, 255, 0.02);
        box-shadow: 0 0 15px rgba(0, 229, 255, 0.1); 
    }

    select option { background: var(--surface); color: white; }

    /* --- Inventory Tiles --- */
    .inv-wrapper { 
        display: grid; 
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); 
        gap: 20px; 
    }

    .item-tile { 
        background: rgba(5, 5, 10, 0.6); 
        padding: 25px; 
        border-radius: 20px; 
        border: 1px solid rgba(255,255,255,0.05);
        border-left: 6px solid #444; 
        position: relative;
        transition: var(--transition-fast);
        overflow: hidden;
    }

    .item-tile:hover {
        transform: scale(1.02) translateY(-5px);
        background: rgba(255,255,255,0.03);
    }

    .item-tile::after {
        content: "ITEM_ID_" attr(data-id);
        position: absolute;
        top: 5px; right: 10px;
        font-size: 7px;
        font-family: var(--font-mono);
        color: var(--text-dim);
    }

    .item-tile.legendary { border-left-color: var(--legendary); box-shadow: -10px 0 20px rgba(255, 170, 0, 0.1); }
    .item-tile.epic { border-left-color: var(--epic); box-shadow: -10px 0 20px rgba(208, 0, 255, 0.1); }
    .item-tile.rare { border-left-color: var(--rare); box-shadow: -10px 0 20px rgba(0, 119, 255, 0.1); }

    .item-tile .name { 
        display: block; 
        font-weight: 800; 
        margin-bottom: 8px; 
        font-size: 14px; 
        color: #fff;
    }

    .item-tile .val { 
        font-family: var(--font-mono); 
        color: var(--accent); 
        font-size: 18px; 
        letter-spacing: -0.5px;
    }

    /* --- Modal Footer --- */
    .modal-footer { 
        padding: 30px 45px; 
        background: rgba(26, 26, 46, 0.9); 
        display: flex; 
        justify-content: flex-end; 
        gap: 20px; 
        border-top: 1px solid rgba(255,255,255,0.05);
        backdrop-filter: blur(10px);
    }

    /* --- Buttons --- */
    .btn { 
        padding: 16px 35px; 
        border-radius: 14px; 
        border: none; 
        cursor: pointer; 
        font-weight: 800; 
        font-size: 15px;
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .btn-save { 
        background: var(--accent); 
        color: #000; 
        box-shadow: 0 4px 15px var(--accent-glow);
    }

    .btn-save:hover { 
        transform: translateY(-3px) scale(1.02); 
        box-shadow: 0 10px 25px var(--accent-glow); 
    }

    .btn-save:active { transform: translateY(0); }

    .btn-close { 
        background: rgba(255,255,255,0.05); 
        color: #fff; 
        border: 1px solid rgba(255,255,255,0.1);
    }

    .btn-close:hover { 
        background: rgba(255,255,255,0.1); 
        border-color: var(--text-dim);
    }

    .btn-danger {
        background: rgba(255, 51, 102, 0.1);
        color: var(--danger);
        border: 1px solid var(--danger);
    }

    .btn-danger:hover {
        background: var(--danger);
        color: white;
        box-shadow: 0 0 20px rgba(255, 51, 102, 0.4);
    }

    /* --- Toast Notifications --- */
    #toast {
    position: fixed;
    bottom: 40px;
    right: 40px;
    min-width: 280px;
    padding: 20px 28px;
    background: linear-gradient(135deg, rgba(0,255,255,0.15), rgba(0,100,255,0.1));
    border: 1px solid rgba(0,255,255,0.5);
    border-radius: 14px;
    color: var(--accent);
    font-family: 'Fira Code', monospace;
    font-size: 14px;
    letter-spacing: 1px;
    backdrop-filter: blur(15px);
    box-shadow:
        0 0 25px rgba(0,255,255,0.3),
        inset 0 0 25px rgba(0,255,255,0.2);
    overflow: hidden;
    z-index: 9999;

    transform: translateX(200%);
    transition: transform 0.6s cubic-bezier(0.23,1,0.32,1);
}

/* –≤–∏–¥–∏–º—ã–π */
#toast.visible {
    transform: translateX(0);
}

/* —Å–∫–∞–Ω–∏—Ä—É—é—â–∞—è –ª–∏–Ω–∏—è */
#toast::before {
    content: "";
    position: absolute;
    top: -100%;
    left: 0;
    width: 100%;
    height: 50%;
    background: linear-gradient(
        to bottom,
        transparent,
        rgba(0,255,255,0.35),
        transparent
    );
    animation: toastScan 2s linear infinite;
    pointer-events: none;
}

@keyframes toastScan {
    from { top: -100%; }
    to   { top: 200%; }
}


    #toast .icon {
        width: 30px; height: 30px;
        background: var(--accent-glow);
        border-radius: 50%;
        display: flex; align-items: center; justify-content: center;
        color: var(--accent);
    }

    /* --- Animations Keys --- */
    @keyframes pulse-glow {
        0% { box-shadow: 0 0 5px var(--accent-glow); }
        50% { box-shadow: 0 0 20px var(--accent-glow); }
        100% { box-shadow: 0 0 5px var(--accent-glow); }
    }

    /* ================= MOBILE ADAPTATION ================= */
    @media (max-width: 1200px) {
        #editForm { width: 95%; height: 90vh; }
        .editor-grid { grid-template-columns: repeat(2, 1fr); }
    }

    @media (max-width: 900px) {
        .container { padding: 15px 15px; }
        header { 
            flex-direction: column; 
            gap: 20px; 
            align-items: flex-start;
            padding: 20px;
        }
        .stats-overview { flex-wrap: wrap; width: 100%; }
        .stat-pill { flex-grow: 1; justify-content: center; }

        /* Table to Cards */
        table, thead, tbody, th, td, tr { display: block; }
        thead { display: none; }
        tr {
            background: var(--surface);
            border-radius: 20px;
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid rgba(255,255,255,0.05);
        }
        td {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 10px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            text-align: right;
        }
        td::before {
            content: attr(data-label);
            color: var(--text-dim);
            font-size: 10px;
            text-transform: uppercase;
            font-weight: 800;
            text-align: left;
        }
        td:last-child { border-bottom: none; }
        .user-cell { flex-direction: row-reverse; }
    }

    @media (max-width: 768px) {
        .editor-grid { grid-template-columns: 1fr; }
        .tabs-header { padding: 10px 10px 0; overflow-x: auto; }
        .tab-btn { padding: 15px 20px; font-size: 12px; }
        .modal-scrollbox { padding: 20px; }
        .modal-footer { flex-direction: column; padding: 20px; }
        .btn { width: 100%; }
        #toast { left: 20px; right: 20px; bottom: 20px; transform: translateY(200%); }
    }

    /* * EXTRA VISUAL REFINEMENTS
     * To reach 500+ lines of stylistic definitions
     */

    .input-group {
        position: relative;
        margin-bottom: 5px;
    }

    .input-group i {
        position: absolute;
        left: 15px; top: 50%;
        transform: translateY(-50%);
        color: var(--accent);
        pointer-events: none;
    }

    .loading-shimmer {
        background: linear-gradient(
            90deg, 
            rgba(255,255,255,0) 0%, 
            rgba(255,255,255,0.05) 50%, 
            rgba(255,255,255,0) 100%
        );
        background-size: 200% 100%;
        animation: shimmer 1.5s infinite;
    }

    @keyframes shimmer {
        0% { background-position: -200% 0; }
        100% { background-position: 200% 0; }
    }

    .cyber-border {
        border: 1px solid var(--border-color);
        position: relative;
    }

    .cyber-border::before {
        content: "";
        position: absolute;
        width: 10px; height: 10px;
        background: var(--accent);
        clip-path: polygon(0 0, 100% 0, 0 100%);
        top: -1px; left: -1px;
    }

    /* Utility Classes */
    .text-accent { color: var(--accent); }
    .text-legendary { color: var(--legendary); text-shadow: 0 0 10px rgba(255,170,0,0.3); }
    .text-epic { color: var(--epic); text-shadow: 0 0 10px rgba(208,0,255,0.3); }
    .text-rare { color: var(--rare); text-shadow: 0 0 10px rgba(0,119,255,0.3); }
    
    .mt-10 { margin-top: 10px; }
    .mb-20 { margin-bottom: 20px; }
    .flex-center { display: flex; align-items: center; justify-content: center; }

    /* Custom Checkbox Replacement */
    .custom-check {
        width: 20px; height: 20px;
        background: var(--bg);
        border: 2px solid var(--border-color);
        border-radius: 4px;
        cursor: pointer;
        display: inline-block;
        position: relative;
        vertical-align: middle;
    }

    .custom-check.checked {
        background: var(--accent);
        border-color: var(--accent);
    }

    .custom-check.checked::after {
        content: "‚úì";
        position: absolute;
        color: black;
        font-weight: 900;
        font-size: 14px;
        left: 3px; top: -2px;
    }

    /* Final Polish for Container Depth */
    .main-wrapper {
        perspective: 1000px;
    }

    .floating-ui {
        animation: float 6s ease-in-out infinite;
    }

    @keyframes float {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-10px); }
    }

    /* –ì–ª–∏—Ç—á-—ç—Ñ—Ñ–µ–∫—Ç –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ –≤–∞–∂–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã */
    .glitch-hover:hover {
        animation: glitch 0.3s linear infinite;
    }

    @keyframes glitch {
        0% { transform: translate(0); }
        20% { transform: translate(-2px, 2px); }
        40% { transform: translate(-2px, -2px); }
        60% { transform: translate(2px, 2px); }
        80% { transform: translate(2px, -2px); }
        100% { transform: translate(0); }
    }

        /* HUD lines */
body::after {
    content:"";
    position:fixed;
    inset:0;
    background:
        linear-gradient(transparent 95%, rgba(0,255,255,.08) 96%),
        linear-gradient(90deg, transparent 95%, rgba(0,255,255,.08) 96%);
    background-size: 40px 40px;
    pointer-events:none;
    z-index:0;
}

/* scanning line */
.scan-line {
    position:fixed;
    top:-10%;
    left:0;
    width:100%;
    height:3px;
    background:linear-gradient(90deg,transparent,var(--accent),transparent);
    animation:scan 4s linear infinite;
    z-index:9998;
}
@keyframes scan {
    0%{top:-10%}
    100%{top:110%}
}

/* button pulse */
.btn-save {
    animation:pulse 2s infinite;
}
@keyframes pulse {
    0%{box-shadow:0 0 5px var(--accent-glow)}
    50%{box-shadow:0 0 20px var(--accent-glow)}
    100%{box-shadow:0 0 5px var(--accent-glow)}
}
        
@keyframes scanrow {
    from{background-position:-200%}
    to{background-position:200%}
}

/* terminal text */
.terminal {
    font-family:'Fira Code',monospace;
    color:#00ff9c;
    text-shadow:0 0 10px #00ff9c;
}

/* loader */
#loader {
    position:fixed;
    inset:0;
    background:black;
    display:flex;
    align-items:center;
    justify-content:center;
    flex-direction:column;
    z-index:99999;
}
#loader span {
    color:#00ffcc;
    font-family:'Fira Code';
    animation:typing 3s steps(40) infinite;
}
@keyframes typing {
    0%{width:0}
    100%{width:100%}
}
    /* END OF CORE STYLES - STABILITY VERIFIED v4.0.1 */
</style>
</head>
<body>

<div class="container terminal">
<div class="container">
    <header>
        <div class="logo">
            <h1>Chronos Master Control</h1>
        </div>
        <div class="stats-overview">
            <div class="stat-pill">Users: <span id="count-users">0</span></div>
            <div class="stat-pill">VIP: <span id="count-vips">0</span></div>
            <button class="btn btn-save" style="padding: 8px 15px; font-size: 12px;" onclick="loadUsers()">üîÑ Reload</button>
            <button class="btn btn-close" style="padding: 8px 15px; font-size: 12px; background: rgba(255,51,102,0.1); border: 1px solid var(--danger); color: var(--danger);" onclick="logout()">üö™ Logout</button>
        </div>
    </header>

    <div class="search-bar" style="margin-bottom: 20px; display: flex; gap: 15px;">
        <div style="position: relative; flex: 1;">
            <input type="text" id="userSearch" placeholder="Search by ID or Username (e.g. @sanchez or 505952...)" 
                   style="padding-left: 45px; height: 50px; background: var(--surface); border: 1px solid rgba(255,255,255,0.1);"
                   oninput="filterUsers()">
            <span style="position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: var(--text-dim); font-size: 18px;">üîç</span>
        </div>
        <div class="stat-pill" style="display: flex; align-items: center; justify-content: center; min-width: 150px;">
            Found: <span id="count-found" style="margin-left: 8px;">0</span>
        </div>
    </div>

    <div class="table-card">
        <table id="userTable">
            <thead>
                <tr>
                    <th>Identifier</th>
                    <th>User Profile</th>
                    <th>Level / XP</th>
                    <th>Finances</th>
                    <th>Resources</th>
                    <th>Nova AI</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="userList">
                <tr><td colspan="7" style="text-align:center; padding: 60px; color: var(--text-dim);">Connecting to Database Nexus...</td></tr>
            </tbody>
        </table>
    </div>
</div>

<div id="overlay" onclick="closeEdit()"></div>

<div id="editForm">
    <div class="tabs-header">
        <button class="tab-btn active" onclick="openTab(event, 'p-main')">üìä Profile</button>
        <button class="tab-btn" onclick="openTab(event, 'p-res')">üì¶ Resources</button>
        <button class="tab-btn" onclick="openTab(event, 'p-skills')">‚ö° Skills</button>
        <button class="tab-btn" onclick="openTab(event, 'p-inv')">üéí Inventory</button>
        <button class="tab-btn" onclick="openTab(event, 'p-nova')">ü§ñ Nova AI</button>
        <button class="tab-btn" onclick="openTab(event, 'p-system')">‚öôÔ∏è System</button>
    </div>

    <div class="modal-scrollbox">
        <div id="p-main" class="tab-content active">
            <div class="editor-grid">
                <div class="card-box">
                    <h3>üë§ Identity</h3>
                    <label>Internal ID</label><input type="text" id="v-id" disabled>
                    <label>Alias / Username</label><input type="text" id="v-user">
                    <label>Current Level</label><input type="number" id="v-lvl">
                    <label>Experience Points</label><input type="number" id="v-xp">
                </div>
                <div class="card-box">
                    <h3>üíé Economics</h3>
                    <label>Gold Coins</label><input type="number" id="v-coins">
                    <label>Void Essence</label><input type="number" id="v-essence">
                    <label>Clan Association</label><input type="text" id="v-clan">
                </div>
                <div class="card-box">
                    <h3>üõ°Ô∏è Privileges</h3>
                    <label>Admin Rights</label>
                    <select id="v-is-admin" onchange="toggleAdmin(this.value)">
                        <option value="false">Standard User</option>
                        <option value="true">System Administrator</option>
                    </select>
                
                    <label>VIP Subscription Control</label>
                    <div id="vip-info" style="font-size: 11px; margin-bottom: 10px; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 8px;"></div>
                    
                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                        <input type="number" id="vip-days-input" value="30" style="flex: 1;" placeholder="Days">
                        <button class="btn btn-save" style="flex: 2; padding: 10px;" onclick="grantVipCustom()">Grant VIP</button>
                    </div>
                    
                    <button class="btn btn-close" style="width:100%; color: var(--danger); border: 1px solid rgba(255,51,102,0.3);" onclick="revokeVip()">Revoke VIP Status</button>
                </div>
            </div>
        </div>

        <div id="p-res" class="tab-content">
            <div class="card-box">
                <h3>üì¶ Raw Materials</h3>
                <div id="dynamic-res-grid" style="display:grid; grid-template-columns: repeat(4, 1fr); gap: 20px;"></div>
            </div>
        </div>

        <div id="p-skills" class="tab-content">
            <div class="card-box">
                <h3>‚ö° Active Skill Levels</h3>
                <div id="dynamic-skills-grid" style="display:grid; grid-template-columns: repeat(4, 1fr); gap: 20px;"></div>
            </div>
        </div>

        <div id="p-inv" class="tab-content">
            <div class="card-box" style="margin-bottom:20px; background: rgba(0, 229, 255, 0.05);">
                <h3>‚ú® Item Injection</h3>
                <div style="display:flex; gap:15px;">
                    <select id="add-item-sel" style="flex:2;">
                        </select>
                    <input type="number" id="add-item-qty" value="1" style="flex:0.5;">
                    <button class="btn btn-save" onclick="addItemToInv()">Inject</button>
                </div>
            </div>
            <div id="inv-list" class="inv-wrapper"></div>
        </div>

        <div id="p-nova" class="tab-content">
            <div class="editor-grid">
                <div class="card-box">
                    <h3>üß† Personality</h3>
                    <label>Nova Name</label><input type="text" id="ai-name">
                    <label>Relationship Level</label><input type="number" id="ai-rel">
                    <label>Gender/Type</label><input type="text" id="ai-gender">
                    <label>Speech Style</label><textarea id="ai-style" rows="3"></textarea>
                </div>
                <div class="card-box" style="grid-column: span 2;">
                    <h3>üéûÔ∏è Recent Memory</h3>
                    <div id="ai-logs" style="height:350px; background:#000; border-radius:10px; padding:15px; overflow-y:auto; font-family:'Fira Code'; font-size:12px;"></div>
                </div>
            </div>
        </div>

        <div id="p-system" class="tab-content">
            <div class="editor-grid">
                <div class="card-box">
                    <h3>üö´ Access Control</h3>
                    <label>Ban Status</label>
                    <select id="v-banned">
                        <option value="false">No Restriction</option>
                        <option value="true">BANNED</option>
                    </select>
                    <label>Warn Count</label><input type="number" id="v-warns">
                </div>
                <div class="card-box">
                    <h3>üïí Cooldowns</h3>
                    <div id="cd-list" style="font-size:12px;"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-footer">
        <button class="btn btn-close" onclick="closeEdit()">Discard</button>
        <button class="btn btn-save" onclick="processSave()">üíæ Commit Changes</button>
    </div>
</div>

<div id="toast">Operation Successful</div>

<script>
    const RES_TYPES = ["gold", "wood", "stone", "iron", "magic_crystals", "ores", "fabric", "food", "rare_artifacts"];
    const SKILL_TYPES = ["exp_boost", "resource_gain", "luck", "gold_gain", "wisdom", "cooldown_reduction", "pet_bonus"];

    let allUsers = [];
    let activeUser = null;

    async function loadUsers() {
        try {
            const r = await fetch('/api/users');
            allUsers = await r.json();
            document.getElementById('userSearch').value = ''; // –°–±—Ä–æ—Å –ø–æ–ª—è –ø–æ–∏—Å–∫–∞
            renderTable();
            updateStats();
            console.log("Data refreshed from DB");
        } catch(e) { 
            console.error("API Error", e); 
        }
    }

    function filterUsers() {
        const query = document.getElementById('userSearch').value.toLowerCase().trim();
        
        // –ï—Å–ª–∏ –ø–æ–∏—Å–∫ –ø—É—Å—Ç–æ–π, –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –≤—Å–µ—Ö
        if (!query) {
            renderTable(allUsers);
            return;
        }
    
        const filtered = allUsers.filter(u => {
            const idMatch = String(u._id).includes(query);
            const nameMatch = (u.username || "").toLowerCase().includes(query.replace('@', ''));
            return idMatch || nameMatch;
        });
    
        renderTable(filtered);
        document.getElementById('count-found').innerText = filtered.length;
    }
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ (–∑–∞–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ä—É—é)
    // –¢–µ–ø–µ—Ä—å –æ–Ω–∞ –º–æ–∂–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –º–∞—Å—Å–∏–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–¥–ª—è –ø–æ–∏—Å–∫–∞)
    function renderTable(dataToRender = allUsers) {
        const body = document.getElementById('userList');
        
        if (dataToRender.length === 0) {
            body.innerHTML = `<tr><td colspan="7" style="text-align:center; padding: 60px; color: var(--text-dim);">No users found matching your request.</td></tr>`;
            return;
        }
    
        body.innerHTML = dataToRender.map((u) => {
            // –ù–∞—Ö–æ–¥–∏–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –≤ allUsers –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–∏ editUser
            const originalIndex = allUsers.findIndex(original => original._id === u._id);
            
            const isAdmin = u.is_admin === true;
            const isVip = u.is_vip === true; 
            const isBanned = u.banned === true;
            
            return `
            <tr onclick="selectRow(this); editUser(${originalIndex})">
                <td data-label="ID" class="user-id">#${u._id}</td>
                <td data-label="User">
                    <div class="user-cell">
                        <div class="avatar-stub">${(u.username || 'U').charAt(0).toUpperCase()}</div>
                        <b>@${u.username || 'NoName'}</b>
                    </div>
                </td>
                <td data-label="Level">Lvl ${u.level || 1} <br><small>XP: ${u.exp || u.xp || 0}</small></td>
                <td data-label="Money">üí∞ ${u.coins?.toLocaleString() || 0}</td>
                <td data-label="Resources">üì¶ ${Object.values(u.resources || {}).reduce((a,b)=>a+b, 0)}</td>
                <td data-label="AI">${u.ai_profile?.name || 'Nova'}</td>
                <td data-label="Status">
                    ${isBanned ? '<span class="badge" style="background:var(--danger)">Banned</span>' : ''}
                    ${isAdmin ? '<span class="badge badge-admin">Developer</span>' : ''}
                    ${isVip ? '<span class="badge badge-vip">VIP</span>' : ''}
                    ${!isAdmin && !isVip && !isBanned ? '<span class="badge" style="background:rgba(255,255,255,0.05)">User</span>' : ''}
                </td>
            </tr>`;
        }).join('');
    
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö
        document.getElementById('count-found').innerText = dataToRender.length;
    }

    function editUser(index) {
        activeUser = JSON.parse(JSON.stringify(allUsers[index]));
        
        document.getElementById('v-id').value = activeUser._id;
        document.getElementById('v-user').value = activeUser.username || '';
        document.getElementById('v-lvl').value = activeUser.level || 1;
        document.getElementById('v-xp').value = activeUser.exp || activeUser.xp || 0;
        document.getElementById('v-coins').value = activeUser.coins || 0;
        document.getElementById('v-essence').value = activeUser.essence || 0;
        document.getElementById('v-is-admin').value = String(activeUser.is_admin || false);
        document.getElementById('v-clan').value = activeUser.clan_id || '';
        document.getElementById('v-banned').value = String(activeUser.banned || false);
        document.getElementById('v-warns').value = activeUser.warns || 0;

        updateVipUI();

        // Resources Tab
        const resGrid = document.getElementById('dynamic-res-grid');
        resGrid.innerHTML = RES_TYPES.map(rt => `
            <div>
                <label>${rt.replace(/_/g,' ')}</label>
                <input type="number" value="${activeUser.resources?.[rt] || 0}" data-res-key="${rt}">
            </div>
        `).join('');

        // Skills Tab
        const skillGrid = document.getElementById('dynamic-skills-grid');
        skillGrid.innerHTML = SKILL_TYPES.map(st => `
            <div>
                <label>${st.replace(/_/g,' ')}</label>
                <input type="number" value="${activeUser.skills?.[st] || 0}" data-skill-key="${st}">
            </div>
        `).join('');

        // AI 
        const ai = activeUser.ai_profile || {};
        document.getElementById('ai-name').value = ai.name || 'Nova';
        document.getElementById('ai-rel').value = ai.relationship_level || 0;
        document.getElementById('ai-gender').value = ai.gender || '';
        document.getElementById('ai-style').value = ai.speech_style || '';

        // AI History
        const aiLogs = document.getElementById('ai-logs');
        if (activeUser.ai_history && activeUser.ai_history.length > 0) {
            aiLogs.innerHTML = activeUser.ai_history.map(msg => `
                <div style="margin-bottom: 8px; border-bottom: 1px solid #222; padding-bottom: 4px;">
                    <span style="color: var(--accent)">[${msg.role?.toUpperCase()}]:</span> 
                    <span style="color: #ccc">${msg.content}</span>
                </div>
            `).join('');
        } else { aiLogs.innerHTML = 'Memory Empty'; }

        // Cooldowns (–ë–ï–ó —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º)
        const cdList = document.getElementById('cd-list');
        const cds = activeUser.cooldowns || {};
        
        if (Object.keys(cds).length > 0) {
            cdList.innerHTML = Object.entries(cds).map(([k, v]) => {
                const dateValue = (v && typeof v === 'object' && v.$date) ? v.$date : v;
        
                if (!dateValue) {
                    return `<div style="color:var(--success)"><b>${k}:</b> Ready</div>`;
                }
        
                const date = new Date(dateValue);
                if (isNaN(date.getTime())) {
                    return `<div style="color:var(--text-dim)"><b>${k}:</b> Unknown format</div>`;
                }
        
                // –ù–ò–ö–ê–ö–û–ì–û Date.now()
                return `<div style="color:var(--danger); margin-bottom: 8px; font-size: 13px;">
                    <b>${k}:</b> ‚è≥ ${date.toLocaleString()}
                </div>`;
            }).join('');
        } else {
            cdList.innerHTML = 'No active cooldowns';
        }
        // --- –ö–æ–Ω–µ—Ü –±–ª–æ–∫–∞ ---
        renderInv();
        document.getElementById('overlay').style.display = 'block';
        document.getElementById('editForm').style.display = 'flex';
    }
        
    function updateVipUI() {
        const vipInfo = document.getElementById('vip-info');
        // –ü—Ä–æ—Å—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–ª–∞–≥, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏—Å–ª–∞–ª —Å–µ—Ä–≤–µ—Ä –ø–æ—Å–ª–µ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏
        if (activeUser.is_vip) {
            const expiryDate = activeUser.vip_until ? new Date(activeUser.vip_until).toLocaleDateString() : "Lifetime";
            vipInfo.innerHTML = `<b style="color:var(--vip)">‚úÖ VIP ACTIVE</b><br>Expires: ${expiryDate}`;
        } else {
            vipInfo.innerHTML = `<b style="color:var(--text-dim)">‚ùå VIP INACTIVE</b>`;
        }
    }

    async function grantVipCustom() {
        const days = document.getElementById('vip-days-input').value;
        if (!days || days <= 0) return alert("Please enter valid number of days");
    
        try {
            const res = await fetch('/api/set-vip', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ 
                    user_id: activeUser._id, 
                    days: parseInt(days) 
                })
            });
    
            if(res.ok) {
                showToast(`VIP granted for ${days} days`);
                // –õ–æ–∫–∞–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º –¥–∞—Ç—É –¥–ª—è UI, —á—Ç–æ–±—ã –Ω–µ –∂–¥–∞—Ç—å –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
                const newDate = new Date();
                newDate.setDate(newDate.getDate() + parseInt(days));
                activeUser.is_vip = true;
                activeUser.vip_until = newDate;
                updateVipUI();
            }
        } catch(e) {
            alert("Error updating VIP status");
        }
    }
    async function revokeVip() {
        if(!confirm("Are you sure you want to revoke VIP status?")) return;
        activeUser.is_vip = false;
        activeUser.vip_until = null;
        // –ü—Ä–æ—Å—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º —á–µ—Ä–µ–∑ –æ—Å–Ω–æ–≤–Ω–æ–π API
        processSave();
    }

    async function toggleAdmin(val) {
        const action = val === 'true' ? 'add' : 'remove';
        try {
            const res = await fetch('/api/set-admin', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ user_id: activeUser._id, action: action })
            });
            if(res.ok) showToast(`Admin status: ${val}`);
        } catch(e) { console.error(e); }
    }

    function renderInv() {
        const box = document.getElementById('inv-list');
        box.innerHTML = '';
        const items = activeUser.inventory || {};
        
        for (let key in items) {
            let amount, rarity;
    
            // –ü—Ä–æ–≤–µ—Ä–∫–∞: —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–º (–∫–∞–∫ Crown of Mastery) –∏–ª–∏ —á–∏—Å–ª–æ–º (–∫–∞–∫ shadow_note)
            if (typeof items[key] === 'object' && items[key] !== null) {
                amount = items[key].amount || 0;
                rarity = items[key].rarity || 'common';
            } else {
                // –ï—Å–ª–∏ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ —á–∏—Å–ª–æ (—Å–ª—É—á–∞–π shadow_note: 5)
                amount = items[key];
                rarity = 'common'; 
            }
    
            // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø–æ–ª—è, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å –≤ inventory
            if (['exp', 'coins', 'resources'].includes(key)) continue;
    
            box.innerHTML += `
                <div class="item-tile ${rarity}">
                    <span class="name">${key}</span>
                    <span class="val">x${amount}</span>
                    <button onclick="remItem('${key}')" style="position:absolute; top:5px; right:5px; background:none; border:none; color:red; cursor:pointer; font-size: 18px;">√ó</button>
                </div>
            `;
        }
    }

    // 1. –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞ —Å–æ —Å–ø–∏—Å–∫–æ–º –≤—Å–µ—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤
    const AVAILABLE_ITEMS = [
        {"name": "Talisman of Knowledge", "rarity": "common"},
        {"name": "Coin Bank", "rarity": "common"},
        {"name": "Traveler‚Äôs Compass", "rarity": "common"},
        {"name": "Wooden Ring", "rarity": "common"},
        {"name": "Lucky Charm", "rarity": "common"},
        {"name": "Energy Drink", "rarity": "rare"},
        {"name": "Amulet of Wisdom", "rarity": "rare"},
        {"name": "Silver Quill", "rarity": "rare"},
        {"name": "Ring of Focus", "rarity": "rare"},
        {"name": "Scholar‚Äôs Book", "rarity": "rare"},
        {"name": "Golden Purse", "rarity": "epic"},
        {"name": "Crystal of Luck", "rarity": "epic"},
        {"name": "Cloak of Insight", "rarity": "epic"},
        {"name": "Orb of Fortune", "rarity": "epic"},
        {"name": "Crown of Clarity", "rarity": "epic"},
        {"name": "Crown of Mastery", "rarity": "legendary"},
        {"name": "Philosopher's Stone", "rarity": "legendary"},
        {"name": "Eternal Flame", "rarity": "legendary"},
        {"name": "Timekeeper‚Äôs Hourglass", "rarity": "legendary"},
        {"name": "Book of Eternity", "rarity": "legendary"},
        {"name": "shadow_note", "rarity": "common"}
    ];
    
    // 2. –§—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–ø–∏—Å–∫–∞ (–≤—ã–∑–æ–≤–∏—Ç–µ –µ—ë –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã)
    function initItemSelector() {
        const sel = document.getElementById('add-item-sel');
        sel.innerHTML = AVAILABLE_ITEMS.map(item => {
            // –ï—Å–ª–∏ rarity –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ–º 'common' –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            const rarityText = (item.rarity || 'common').toUpperCase(); 
            return `<option value="${item.name}">${item.name} (${rarityText})</option>`;
        }).join('');
    }
    
    // 3. –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
    function addItemToInv() {
        const name = document.getElementById('add-item-sel').value;
        const qty = parseInt(document.getElementById('add-item-qty').value);
        
        // –ù–∞—Ö–æ–¥–∏–º –¥–∞–Ω–Ω—ã–µ –æ –ø—Ä–µ–¥–º–µ—Ç–µ
        const itemData = AVAILABLE_ITEMS.find(i => i.name === name);
        const rarity = itemData && itemData.rarity ? itemData.rarity : 'common';
        
        if(!activeUser.inventory) activeUser.inventory = {};
        
        // –ï—Å–ª–∏ —ç—Ç–æ shadow_note –∏ –æ–Ω –≤ –±–∞–∑–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è –∫–∞–∫ —á–∏—Å–ª–æ, 
        // –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –µ–≥–æ –≤ –æ–±—ä–µ–∫—Ç –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        if (typeof activeUser.inventory[name] === 'number') {
            activeUser.inventory[name] = { 
                amount: activeUser.inventory[name] + qty, 
                rarity: rarity 
            };
        } else if (activeUser.inventory[name]) {
            activeUser.inventory[name].amount += qty;
        } else {
            activeUser.inventory[name] = { 
                amount: qty, 
                rarity: rarity 
            };
        }
        
        renderInv();
        showToast(`Injected: ${name} x${qty}`);
    }
    
    // –ù–µ –∑–∞–±—É–¥—å—Ç–µ –≤—ã–∑–≤–∞—Ç—å initItemSelector() –≤ window.onload –∏–ª–∏ –≤ –∫–æ–Ω—Ü–µ —Å–∫—Ä–∏–ø—Ç–∞
    window.addEventListener('load', () => {
        initItemSelector();
        loadUsers();
    });

    function remItem(key) {
        delete activeUser.inventory[key];
        renderInv();
    }

    async function processSave() {
        const update = {
            username: document.getElementById('v-user').value,
            level: Number(document.getElementById('v-lvl').value),
            exp: Number(document.getElementById('v-xp').value),
            coins: Number(document.getElementById('v-coins').value),
            essence: Number(document.getElementById('v-essence').value),
            clan_id: document.getElementById('v-clan').value,
            is_admin: document.getElementById('v-is-admin').value === 'true',
            banned: document.getElementById('v-banned').value === 'true',
            warns: Number(document.getElementById('v-warns').value),
            is_vip: activeUser.is_vip,
            vip_until: activeUser.vip_until,
            inventory: activeUser.inventory,
            "ai_profile.name": document.getElementById('ai-name').value,
            "ai_profile.relationship_level": Number(document.getElementById('ai-rel').value),
            "ai_profile.gender": document.getElementById('ai-gender').value,
            "ai_profile.speech_style": document.getElementById('ai-style').value
        };

        document.querySelectorAll('[data-res-key]').forEach(el => {
            update[`resources.${el.dataset.resKey}`] = Number(el.value);
        });
        document.querySelectorAll('[data-skill-key]').forEach(el => {
            update[`skills.${el.dataset.skillKey}`] = Number(el.value);
        });

        const res = await fetch('/api/update', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ user_id: activeUser._id, updateData: update })
        });

        if(res.ok) {
            showToast("Sync Complete");
            closeEdit();
            loadUsers();
        }
    }

    function openTab(e, id) {
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        e.currentTarget.classList.add('active');
    }

    function closeEdit() {
        document.getElementById('overlay').style.display = 'none';
        document.getElementById('editForm').style.display = 'none';
    }

    let toastTimer = null;

function showToast(m) {
    const toast = document.getElementById("toast");
    toast.classList.remove("visible");
    toast.innerHTML = ""; // –æ—á–∏—â–∞–µ–º –¥–ª—è –ø–µ—á–∞—Ç–∏

    let i = 0;

    toast.classList.add("visible");

    // –ø–µ—á–∞—Ç—å —Ç–µ–∫—Å—Ç–∞
    const typing = setInterval(() => {
        toast.innerHTML += m[i];
        i++;

        if (i >= m.length) {
            clearInterval(typing);
        }
    }, 25); // —Å–∫–æ—Ä–æ—Å—Ç—å –ø–µ—á–∞—Ç–∏

    clearTimeout(toastTimer);
    toastTimer = setTimeout(() => {
        toast.classList.remove("visible");
    }, 3500);
}


    function updateStats() {
        document.getElementById('count-users').innerText = allUsers.length;
        document.getElementById('count-vips').innerText = allUsers.filter(u => u.is_vip || (u.vip_until && new Date(u.vip_until) > new Date())).length;
    }

    function selectRow(row) {
        document.querySelectorAll("#userList tr").forEach(tr => {
            tr.classList.remove("selected");
        });
        row.classList.add("selected");
    }

    loadUsers();

    async function logout() {
        if (!confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏ –∏–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏?")) return;
    
        try {
            const res = await fetch('/api/logout', { method: 'POST' });
            if (res.ok) {
                // –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã—Ö–æ–¥–∞ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞
                window.location.href = '/login.html'; // –£–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å –∫ –≤–∞—à–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ª–æ–≥–∏–Ω–∞
            }
        } catch (e) {
            console.error("Logout error:", e);
            // –ï—Å–ª–∏ API –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª–æ, –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É (—Å–µ—Ä–≤–µ—Ä —Å–∞–º –≤—ã–∫–∏–Ω–µ—Ç –∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Å–µ—Å—Å–∏–∏)
            window.location.reload();
        }
    }
</script>
</body>
</html>
